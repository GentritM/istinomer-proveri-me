{% extends "layout.html" %}

{% block style %}
    <style>
        a.source-url, a.source-url:hover{
            color: white;
        }
        .list-group-factcheckr li { background: white; }
        .list-group-factcheckr li:nth-child(odd) { background: #E8E8EE; }
    </style>
{% endblock %}
{% block script %}
<script type="text/javascript">
    $(document).ready(function(){

        $('.datepicker').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true
        });

        $('#editSubmitBtn').click(function(){

            var data = {
                'doc_id': $('#doc_id_modal').val(),
                'evaluation_mark': $('#evaluation_mark').val(),
                'category': $('#category').val(),
                'date_of_statement': $('#date_of_statement').val(),
                'date_of_article_pub': $('#date_of_article_pub').val(),
                'author_of_article': $('#author_of_article').val(),
                'classification': $('#classification').val(),
                'grade': $('#grade').val()
            };

            if($('#classification').val() == "Promise"){
                data['promise_due_date'] = $('#dueness_promise').val();
            }

            if($("#check_author").is(':checked')){
                data['politician'] = true;
                data['quote_author'] = $('#politician').val();
                data['quote_author_affiliation'] = $('#politician_party option:selected').html();
            }
            else{
                data['politician'] = false;
                data['quote_author'] = $('#quote_author').val()
                data['quote_author_affiliation'] = $('#quote_affiliation').val()
            }

            $.ajax({
                type: "POST",
                url: "{{ url_for("main.submit_data") }}",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8"
              }).done(function () {
                document.location = "{{ url_for( 'main.index') }}"
            }).fail(function () { });
        });

         $(".editParam").click(function(){
              var row_id = $(this).attr('id');
             var container = $('#'+row_id + " #dataContainer").val();

             $('#doc_id_modal', "#editModal").val(row_id);
{#              $('#grade', "#editModal").val($('#grade', "#" + row_id).text().trim());#}
{#             $('#evaluation_mark', "#editModal").val($('#factChecked', "#" + row_id).text().trim());#}

             if ($('#classification', "#" + row_id).length){
                 $('#classification', "#editModal").val($('#classification', "#" + row_id).text().trim());
             }
             var ca = JSON.parse(container);
             alert(ca['grade']);

{#            $('#evaluation_mark', "#editModal").val(container['mark']);#}
{#            $('#category', "#editModal").val(container['mark']);#}
{#            $('#date_of_statement', "#editModal").val(container['mark']);#}
{#            $('#date_of_article_pub', "#editModal").val(container['mark']);#}
{#            $('#author_of_article', "#editModal").val(container['mark']);#}
{#            $('#classification', "#editModal").val(container['mark']);#}
{#            $('#grade', "#editModal").val(container['mark']);#}
         });

        $('.deleteBtn').click(function(){
            var row_id = $(this).attr('id');
            $('#reason_id').val(row_id);

            $('#inappropriate', "#reasonModal").val($('#inapproText', "#" + row_id).text().trim());
        });

        $('.inappropriateLink').click(function(){
            var row_id = $(this).attr('id');
            $('#textRsn', "#showReasonModal").text($('#inapproText', "#" + row_id).text().trim());
        });

        $('#check_author').change(function(){
            if($(this).is(':checked')){

                $('.quoteAuth').hide();
                $('.quoteAffil').hide();

                $('.politicianDiv').show();
                $('.polParty').show();

            }
            else{
                $('.quoteAuth').show();
                $('.quoteAffil').show();

                $('.politicianDiv').hide();
                $('.polParty').hide();
            }
        });

        if($('#classification').val() == "Promise"){
            $('#dueness_promise').addClass('datepicker');
            $('#dueness_promise').removeAttr("disabled");

        }
        else if($('#classification').val() == "Truthfulness"){
            $('#dueness_promise').prop("disabled", true);
            $('#dueness_promise').addClass('datepicker');
        }
        else if($('#classification').val() == "Consistency"){
            $('#dueness_promise').prop("disabled", true);
            $('#dueness_promise').addClass('datepicker');
        }
        else{
            $('#dueness_promise').prop("disabled", true);
            $('#dueness_promise').addClass('datepicker');
        }

        $('#classification').change(function(){

           if($(this).val() == "Promise"){
                $('#dueness_promise').addClass('datepicker');
                $('#dueness_promise').removeAttr("disabled");
                $('.gradeDiv #grade option').remove();

               var promises_array = [
                    'Ispunjeno', 'Skoro ispunjeno',
                    'Radi se na tome', 'Krenuli pa stali',
                    'Neispunjeno', 'Ni započeto'
                ];

               $.each(promises_array, function(idx, value){
                  $(".gradeDiv #grade").append($("<option></option>").val(value).html(value));
               });

           }
            else if($(this).val() == "Truthfulness"){
                $('#dueness_promise').prop("disabled", true);
                $('#dueness_promise').addClass('datepicker');
               $('.gradeDiv #grade option').remove();

               var truthfulness_array = [
                   'Istina', 'Skoro istina', 'Poluistina',
                   'Skoro neistina', 'Neistina', 'Kratke noge'
               ];
               $.each(truthfulness_array, function(idx, value){
                  $(".gradeDiv #grade").append($("<option></option>").val(value).html(value));
               });

            }
            else if($(this).val() == "Consistency"){
                $('#dueness_promise').prop("disabled", true);
                $('#dueness_promise').addClass('datepicker');
               $('.gradeDiv #grade option').remove();

               var consistency_array = ['Dosledno', 'Nedosledno', 'Nešto između'];

               $.each(consistency_array, function(idx, value){
                  $(".gradeDiv #grade").append($("<option></option>").val(value).html(value));
               });
            }
            else{
                $('#dueness_promise').prop("disabled", true);
                $('#dueness_promise').addClass('datepicker');

            }
        });

        $('#politician_party').val($('#politician').val());
        $('#politician').change(function(){
            $('#politician_party').val($(this).val());
        });

    });
</script>
{% endblock %}

{% block content %}
<section class="container content-section text-center">
    <div class="row">
        <div class="col-lg-12" style="padding-left:15%;padding-right:15%">
            <ul class="list-group list-group-factcheckr">
            {% for req in factcheck_requests %}
                <li id="{{ req._id }}" class="list-group-item" style="padding-bottom:0.6em;">
                    <input type="hidden" id="dataContainer" value="{{ req|safe }}">
                    {{ req.text }}
                    <div style="margin-top:0.5em" align="right">
                        {% if req.flg_inappropriate is undefined %}
                            <span id="factChecked" class="label label-{% if req.mark == "True" %}success{% elif req.mark == "False" %}danger{% else %}warning{% endif %}">
                                {{ req.mark }}
                            </span>
                        {% endif %}
                        {% if req.classification is defined %}
                            <span id="classification" class="label label-primary" style="margin: 2px;">
                                {{ req.classification }}
                            </span>
                        {% endif %}
                        {% if req.grade is defined %}
                            <span id="grade" class="label label-primary" style="margin: 2px;">
                                {{ req.grade }}
                            </span>
                        {% endif %}
                        <span class="label label-default" style="margin-left:2px;">
                            <a class="source-url" href="{{ req.url }}" targ="_blank">{{ req.domain }}</a>
                        </span>
                        {% if session.logged_in is defined %}
                            {% if req.flg_inappropriate is undefined %}
                                <span class="editSpan" style="margin-left:2px;">
                                    <a class="btn btn-sm btn-success editParam" id="{{ req._id }}" data-toggle="modal" data-target="#editModal"><i class="glyphicon glyphicon-pencil"></i></a>
                                </span>
                                 <span class="" style="margin-left:2px;">
                                    <a class="btn btn-sm btn-danger deleteBtn" id="{{ req._id }}" data-toggle="modal" data-target="#reasonModal" ><i class="glyphicon glyphicon-trash"></i></a>
                                </span>
                            {% else %}
                                <span class="label label-danger" id="inapprSpan" style="margin-left:2px;">
                                    <a class="source-url inappropriateLink" id="{{ req._id }}"  data-toggle="modal" data-target="#showReasonModal" targ="_blank">inappropriate</a>
                                    <span id="inapproText" style="display: none">{{ req.inappropriate_rsn }}</span>
                                </span>
                            {% endif %}
                        {% endif %}
                    </div>
                <br><br>
                </li>
            {% endfor %}
            </ul>
        </div>
    </div>
</section>
<div id="loginModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Login as Admin</h4>
          </div>
          <div class="modal-body">
              <form class="form-horizontal" method="post" action="{{ url_for("admin.login") }}">
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.username.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.username(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.password.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.password(class="form-control pull-left") }}
                      </div>
                  </div>
                   <div class="row form-group">
                    <button type="submit" class="btn btn-default col-xs-offset-8">Sign in</button>
                   </div>
              </form>

          </div>
        </div>
      </div>
</div>

    <div id="editModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Edit Parameters</h4>
          </div>
          <div class="modal-body">
              <form class="form-horizontal" id="editForm">
                  <div class="row form-group">
                          {{ form.doc_id(id="doc_id_modal") }}
                      <div class=" col-xs-5">
                          {{ form.classification.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.classification(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class="col-xs-5">
                          {{ form.grade.label(class="control-label pull-right") }}
                      </div>
                      <div class="col-xs-5 gradeDiv">
                          {{ form.grade(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group dueDate">
                      <div class=" col-xs-5">
                          {{ form.dueness_promise.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.dueness_promise(class="form-control pull-left datepicker",  disabled="disabled") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.evaluation_mark.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.evaluation_mark(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.category.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.category(class="form-control pull-left") }}
                      </div>
                  </div>
                    <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.author_of_article.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.author_of_article(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.check_author.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.check_author(class="pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group politicianDiv" style="display: none;">
                      <div class=" col-xs-5">
                          {{ form.politician.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.politician(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group polParty" style="display: none;">
                      <div class=" col-xs-5">
                          {{ form.politician_party.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.politician_party(class="form-control pull-left", disabled="disabled") }}
                      </div>
                  </div>
                  <div class="row form-group quoteAuth">
                      <div class=" col-xs-5">
                          {{ form.quote_author.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.quote_author(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group quoteAffil">
                      <div class=" col-xs-5">
                          {{ form.quote_affiliation.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.quote_affiliation(class="form-control pull-left") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.date_of_statement.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.date_of_statement(class="form-control pull-left datepicker") }}
                      </div>
                  </div>
                  <div class="row form-group">
                      <div class=" col-xs-5">
                          {{ form.date_of_article_pub.label(class="control-label pull-right") }}
                      </div>
                      <div class=" col-xs-5">
                          {{ form.date_of_article_pub(class="form-control pull-left datepicker") }}
                      </div>
                  </div>

                   <div class="row form-group">
                    <button type="button" id="editSubmitBtn" class="btn btn-default col-xs-offset-8">Submit</button>
                   </div>
              </form>
          </div>
        </div>
      </div>
</div>

<div id="reasonModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Why this entry is inappropriate?</h4>
          </div>
          <div class="modal-body">
              <form class="form-horizontal" method="post" action="{{ url_for("main.edit_params") }}">
                  <div class="row form-group">
                    {{ form.doc_id(id="reason_id") }}
                    <div class="col-xs-5">
                        {{ form.inappropriate.label(class="pull-right") }}
                    </div>
                    <div class="col-xs-7">
                        {{ form.inappropriate(class="form-control") }}
                    </div>
                  </div>
                  <div class="row form-group">
                    <button type="submit" id="btnFlagEntry" class="btn btn-default col-xs-offset-6">Submit</button>
                  </div>
              </form>
          </div>
        </div>
      </div>
</div>

    <div id="showReasonModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Reason why this content is inappropriate!</h4>
          </div>
          <div class="modal-body">
              <div class="row form-group">
                <p id="textRsn" style="margin: 5px; padding: 2px"></p>
              </div>
          </div>
        </div>
      </div>
</div>
{% endblock %}